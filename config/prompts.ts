import { PromptConfig } from '@/types';

// 默认提示词配置
export const DEFAULT_PROMPTS: PromptConfig = {
  generatePreview: `你是一名顶级的PPT设计师和视觉沟通专家。
我会为你提供【PPT模板图片】作为风格参考，以及【台词脚本】。

**重要说明：**
- 模板图片仅供参考风格（配色、装饰、排版风格等），不是让你复制它的内容
- 如果模板图片中包含多张PPT页面的截图拼接，你只需要参考其中的设计风格，**最终只生成单独的一页PPT**，不要在一张图里塞多个页面

**在你生成最终图片之前，请在你的脑中，必须先完成以下三步思考（这个思考过程不需要输出给我看）：**

1. **分析脚本，提炼核心隐喻**：首先，深入理解【台词脚本】的核心思想。然后，找到一个最能直观传达这个思想的"视觉隐喻"或"核心心理画面"。（例如，如果脚本讲"目标"，隐喻就可以是"靶心"；如果讲"合作"，隐喻就可以是"齿轮"）。

2. **构思画面，强调图文交融**：基于这个"视觉隐喻"，构思一个具体的、富有创意的插图。这张插图必须是整个页面的视觉焦点，与文字内容平分秋色，共同构成一个完整的作品。你的任务是设计一张"图文并茂"的页面，绝不能只展示文字。

3. **融合模板，规划布局**：最后，思考如何将这个插图和文字，按照我提供的【PPT模板图片】的风格（如配色、边框、质感），进行优雅地融合与排版。

**你的任务：**
现在，请完成以上思考，然后直接生成一张图文并茂、排版精美的最终PPT页面图片给我。

---

**【台词脚本】**：
{{script}}

---

请生成**单独一页**完整的PPT页面效果图，包含：
1. 基于模板风格的背景和装饰
2. 醒目的标题和副标题（使用渐变色、投影等效果美化）
3. 清晰的文字内容（要点列表），**务必使用专业的文本框设计**：
   - 每个要点都要有精美的文本框背景（圆角矩形、边框、阴影等）
   - 使用不同的字体大小和颜色层次区分标题和内容
   - 添加图标或序号装饰文本框
   - 文字排版要有呼吸感，不要全部黑色字堆砌
4. 与内容主题相关的精美插画或视觉元素
5. 协调的配色和排版，整体设计要精致、专业、有设计感
6. 16:9 宽屏比例

直接生成图片，不要输出文字描述。`,

  generatePreviewNoTemplate: `你是一名顶级的PPT设计师和视觉沟通专家。
我会为你提供【台词脚本】，请为我设计一张专业的PPT页面。

**在你生成最终图片之前，请在你的脑中，必须先完成以下思考（这个思考过程不需要输出给我看）：**

1. **分析脚本，提炼核心隐喻**：首先，深入理解【台词脚本】的核心思想。然后，找到一个最能直观传达这个思想的"视觉隐喻"或"核心心理画面"。（例如，如果脚本讲"目标"，隐喻就可以是"靶心"；如果讲"合作"，隐喻就可以是"齿轮"）。

2. **构思画面，强调图文交融**：基于这个"视觉隐喻"，构思一个具体的、富有创意的插图。这张插图必须是整个页面的视觉焦点，与文字内容平分秋色，共同构成一个完整的作品。你的任务是设计一张"图文并茂"的页面，绝不能只展示文字。

3. **选择风格，规划布局**：根据内容的性质，选择一个合适的设计风格（简约商务、科技感、扁平插画、学术严谨等），然后规划整体布局和配色。

**你的任务：**
现在，请完成以上思考，然后直接生成一张图文并茂、排版精美的最终PPT页面图片给我。

---

**【台词脚本】**：
{{script}}

---

请生成完整的PPT页面效果图，包含：
1. 简洁大气的背景设计
2. 醒目的标题和副标题（使用渐变色、投影等效果美化）
3. 清晰的文字内容（要点列表），**务必使用专业的文本框设计**：
   - 每个要点都要有精美的文本框背景（圆角矩形、边框、阴影等）
   - 使用不同的字体大小和颜色层次区分标题和内容
   - 添加图标或序号装饰文本框
   - 文字排版要有呼吸感，不要全部黑色字堆砌
4. 与内容主题相关的精美插画或视觉元素
5. 协调的配色（建议使用蓝色系或橙色系等专业配色）和排版，整体设计要精致、专业、有设计感
6. 16:9 宽屏比例

直接生成图片，不要输出文字描述。`,

  extractImage: `请根据这张裁剪后的图片，重新生成一个独立的、超高清质量的插画。

**重要任务：**
1. 识别图片中的主要视觉元素（插画、图标、图形、图表等）
2. **完全忽略并去除图片中的所有文字内容**（包括乱码、英文、中文等任何文字）
3. 只保留视觉图形元素（形状、图标、插画、装饰等）
4. 重新绘制这些视觉元素，保持原有的风格、配色和构图
5. **背景必须使用纯白色（#FFFFFF），绝对不要使用透明背景！这是强制要求！**
6. **输出超高清图片（1024x1024 或更高分辨率），确保细节清晰锐利**
7. 确保插画清晰、干净、独立、可直接使用

**关键要求（必须严格遵守）：**
- 生成的插画中不能包含任何文字！
- 背景必须是**纯白色**（#FFFFFF），绝对不要使用透明背景或其他颜色！
- 必须是**超高清**画质，边缘清晰，细节丰富！
- 图片要足够大，分辨率至少 1024x1024！

直接生成图片，不要输出文字描述。`,
};

// 从localStorage加载用户自定义提示词
export function loadPromptConfig(): PromptConfig {
  if (typeof window === 'undefined') {
    return DEFAULT_PROMPTS;
  }

  try {
    const saved = localStorage.getItem('ppt-master-prompts');
    if (saved) {
      const parsed = JSON.parse(saved);
      return {
        ...DEFAULT_PROMPTS,
        ...parsed,
      };
    }
  } catch (error) {
    console.error('Failed to load prompt config:', error);
  }

  return DEFAULT_PROMPTS;
}

// 保存用户自定义提示词到localStorage
export function savePromptConfig(config: PromptConfig): void {
  if (typeof window === 'undefined') {
    return;
  }

  try {
    localStorage.setItem('ppt-master-prompts', JSON.stringify(config));
  } catch (error) {
    console.error('Failed to save prompt config:', error);
  }
}

// 重置为默认提示词
export function resetPromptConfig(): void {
  if (typeof window === 'undefined') {
    return;
  }

  try {
    localStorage.removeItem('ppt-master-prompts');
  } catch (error) {
    console.error('Failed to reset prompt config:', error);
  }
}
